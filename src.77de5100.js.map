{"version":3,"sources":["gtihub-api.ts","metadata.ts","url.ts","embedder.ts","escape.ts","index.ts"],"names":[],"mappings":";;;;;;AKAA,AJAa,IIAb,GJAa,CAAA,MIAb,EJAa,CIAb,EJAwB,EAAX,GIAb,CAAA,YAAA,CAAA;ADAA,AJEA,AEAA,SEFgB,AJEA,AEAA,GEFhB,CAAoB,IAApB,CJEA,CIF+B,AJEL,GEA1B,CAA8B,GAA9B,CFAA,CEAyC,CFAK,QAA9C,EAA6D;AIDzD,AJEA,AKFJ,AHEI,IGFJ,EHEQ,CAAC,EEFE,AJEA,CEAC,EGFZ,CDAe,CAAC,AJEA,AEAA,CFCV,AKHN,KHEY,CEFD,AFEY,CEFC,ACAxB,CAAA,GDAW,EAAmB,KCA9B,CDAW,ACAX,EDAsC,EFE1B,EAA8B,GEF/B,AFEC,CEFkC,AFE1C,GFCE,CIHK,EAAyC,GJG9C,CAAgC,EIH3B,CAAP,KJG0C,CAAC,IAAzC,EAA6C,GAA7C,EAA6C,MAA7C,CAAiD,QAAQ,CAAC,IAA1D,EAA8D,YAA9D,EAA8D,MAA9D,CAA2E,QAAQ,CAAC,IAApF,EAAwF,GAAxF,EAAwF,MAAxF,CAA4F,QAA5F,CADU,EAEV;AIHL,AJIO,AEFJ,IFEI,KEFG,CAAC,CFEG,AEFF,EFEI,EEFN,CAAO,GAAP,CAAP;AFGM,AKLV,AHGC,IGHD,YLKoB,AKLpB,GAAA,OAAA,CAAA,cAAA,CAAA;ADFA,AJMiB,OINjB,CAAA,GAAA,GAAA,GAAA;AJKM,AKFN,AHDA,GFCgB,CAAL,AKAX,CLQO,EETP,CAAA,CFCW,CAQC,IKRZ,GAAA,GLQY,CAAA,AETZ,EFSa,CKRb,AHDA,CGCA,YAAA,AHDA,CGCA;ALQiB,WAAA,CAAC,CAAC,IAAF,EAAA;AAAQ,AKPzB,AHGA,GFJW,CKCX,CLQO,IATI,AKCX,AHGgB,CFKJ,EKRZ,MHGA,CGHA,AHG2B,CFKf,AKRZ,CLQY,EAAC,IKRb,CAAA,GHGA,EAA+C;AFK9B,AEJP,MAAA,EAAA,GFIO,AEJmB,IFIf,CAAC,CAAC,CAAC,KEJwB,CAAC,CFI5B,CAAJ,GEJmB,CAAmB,CAAnB,EAAsB,KAAtB,CAA4B,KAA5B,CAA1B;AFIsB,AKNhC,AHEU,GFLC,CAAP,EEKQ,GGFH,CHEO,GAAA,EAAA,CAAA,CAAA,CAAN,IGFV,CAAuB,SAAvB,EAAuC;A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","file":"src.77de5100.js","sourceRoot":"../src","sourcesContent":["import { PathSpec } from \"./types\";\n\nexport function fetchFile(pathSpec: PathSpec, fileName:string) {\n    return fetch(\n      `https://api.github.com/repos/${pathSpec.user}/${pathSpec.repo}/contents/${pathSpec.path}/${fileName}`,\n      {\n        headers: {\n          'Accept': 'application/vnd.github.v3+json'\n        }\n      }\n    )\n      .then(r => r.json())\n      .then(r => atob(r.content))\n  }","export const metadata = {}","import { PathSpec } from \"./types\";\n\nexport function isAbsoluteUrl(url: string) {\n    var r = new RegExp('^(?:[a-z]+:)?//', 'i');\n    return r.test(url);\n}\n\nexport function parseHash (locationHash: string): PathSpec {\n    const [ user, repo, ...path ] = locationHash.slice(1).split(/\\//g);\n    return { user, repo, path: path.join('/') };\n}","import { fetchFile } from \"./gtihub-api\";\nimport { metadata } from \"./metadata\";\nimport { PathSpec } from \"./types\";\nimport { isAbsoluteUrl } from \"./url\";\n\nfunction embedResource(el: HTMLElement, mime: string, src: string, pathSpec: PathSpec) {\n    const parts = src.split(/\\//g);\n    const path = parts.slice(0, -1);\n    const fileName = parts.slice(-1)[0];\n\n    return fetchFile(\n      {\n        ...pathSpec,\n        path: [pathSpec.path].concat(path).join('/')\n      }, \n      fileName\n    )\n      .then(file => {\n        if (!metadata['scripts']) {\n            metadata['scripts'] = {}\n        }\n        if (path.filter(p => p !== '.').length === 0) {\n            if (!metadata[mime]) {\n                metadata[mime] = {}\n            }\n            metadata[mime][fileName] = file; \n        }\n        el.setAttribute('src', `data:${mime};base64,${btoa(file)}`);\n      })\n}\n  \nexport function embedAllReferences(htmlText: string, pathSpec: PathSpec) {\n    const parser = new DOMParser();\n    const htmlDoc = parser.parseFromString(htmlText, 'text/html');\n    const promises = [];\n    \n    const titleEl = htmlDoc.querySelector('title');\n    metadata['title'] = titleEl ? titleEl.textContent : '';\n\n    const descriptionMeta = htmlDoc.querySelector('meta[name=\"description\"]');\n    metadata['description'] = descriptionMeta ? descriptionMeta.getAttribute('content') : '';\n\n    htmlDoc.querySelectorAll('script').forEach(el => {\n      const src = el.getAttribute('src');\n      if (src && !isAbsoluteUrl(src)) {\n        promises.push(embedResource(el, 'text/javascript', src, pathSpec))\n      }\n    })\n    return Promise.all(promises)\n      .then(() => htmlDoc.documentElement.outerHTML)\n  }","export function esc(html:string) {\n    return html.replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}","import { embedAllReferences } from \"./embedder\";\nimport { esc } from \"./escape\";\nimport { fetchFile } from \"./gtihub-api\";\nimport { metadata } from \"./metadata\";\nimport { parseHash } from \"./url\";\n\nfunction createPreview(indexHtml:string) {\n  const div = document.createElement('div');\n    div.innerHTML = `<iframe\n      width=\"1100\"\n      height=\"600\"\n      frameBorder=\"0\"\n      src=\"data:text/html;base64,${btoa(indexHtml)}\"\n    ></iframe>`;\n  \n    return div;\n}\n\nconst pathSpec = parseHash(window.location.hash);\n\nfetchFile(pathSpec, 'index.html')\n  .then(indexHtml => {\n    metadata['index.html'] = indexHtml;\n    return embedAllReferences(indexHtml, pathSpec);\n  })\n  .then(processedIndexHtml => {\n    if (metadata['title']) {\n      const h1 = document.createElement('h1');\n      h1.textContent = metadata['title'];\n      document.body.appendChild(h1);\n      document.title = 'vw: ' + metadata['title'];\n    }\n    if (metadata['description']) {\n      const title = document.createElement('p');\n      title.textContent = metadata['description'];\n      document.body.appendChild(title);\n    }\n\n    document.body.appendChild(createPreview(processedIndexHtml));\n\n    const div = document.createElement('div');\n    div.classList.add('file');\n    div.innerHTML = `<label>index.html</label>\n      <pre><code class=\"language-html\">${esc(metadata['index.html'])}</code></pre>`\n    document.body.appendChild(div);\n\n    for (const scriptName in metadata['text/javascript']) {\n      const scriptContent = metadata['text/javascript'][scriptName];\n      const div = document.createElement('div');\n      div.classList.add('file');\n      div.innerHTML = `<label>${scriptName}</label>\n        <pre><code class=\"language-javascript\">${scriptContent}</code></pre>`\n      document.body.appendChild(div);\n    }\n\n    (window as any).hljs.highlightAll();\n  })\n"]}